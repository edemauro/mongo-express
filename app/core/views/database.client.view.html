<!-- {% block title %}{{ dbName }}{% endblock %} -->

<div class="panel panel-default">
  <div class="panel-heading">
    <div style="display: inline-block;">
      <h4 style="font-weight: bold;">Collections</h4>
    </div>
    <form class="form-inline" style="float: right;" ng-if="!vm.context.readOnly" ng-submit="vm.addCollection()">
      <div class="input-group">
        <input class="form-control" type="text" ng-model="vm.collection" name="collection" placeholder="Collection Name" uib-popover="Collection names must begin with a letter or underscore, and can contain only letters, numbers, underscores and dots.">
          <span class="input-group-btn">
            <button type="submit" class="btn btn-primary pull-right">
              <span class="glyphicon glyphicon-plus"></span>
              Create collection
            </button>
          </span>
      </div><!-- /input-group -->
    </form>

  </div>
  <div class="panel-body no-padding">
    <table class="table table-bordered table-striped table-condensed no-margin">
      <tr ng-repeat="c in vm.context.ctx.colls">
        <td class="col-md-2">
          <a ui-sref="collection({ database: '{{ vm.context.dbName }}', collection: '{{ c }}' })" class="btn btn-success btn-block">
            <span class="glyphicon glyphicon-eye-open"></span><br>View
          </a>
        </td>
        <td class="col-md-1">
          <a download="{{ c }}.json" target="_self" href="{{ vm.context.baseHref }}db/{{ vm.context.dbName }}/export/{{ c }}" class="btn btn-warning btn-block">
            <span class="glyphicon glyphicon-floppy-save"></span><br>Export
          </a>
        </td>
        <td class="col-md-1">
          <a download="{{ c }}.json" href="{{ vm.context.baseHref }}db/{{ vm.context.dbName }}/expArr/{{ c }}" class="btn btn-warning btn-block">
            <span class="glyphicon glyphicon-floppy-save"></span><br>[JSON]
          </a>
        </td>
        <td>
          <h3>
            <a ui-sref="collection({ database: '{{ vm.context.dbName }}', collection: '{{ c }}' })">{{ c }}</a>
          </h3>
        </td>
        <td class="col-md-1" ng-if="!vm.context.readOnly">
          <button class="btn btn-danger btn-block deleteButton" tooltip-placement="top-right" uib-tooltip="Warning! Are you sure you want to delete this collection? All documents will be deleted." ng-click="vm.deleteCollection(c)">
            <span class="glyphicon glyphicon-trash"></span><br>Del
          </button>
        </td>
      </tr>
    </table>
  </div>
</div>

<script type="text/ng-template" id="collectionModalContent.html">
  <div class="modal-header">
    <button type="button" class="close" ng-click="vm.close()">
      <span aria-hidden="true">&times;</span>
    </button>
    <h4 class="modal-title" id="myModalLabel">Delete collection</h4>
  </div>
  <div class="modal-body">
    <p>
      Be careful! You are about to delete whole <strong>{{ vm.collection }}</strong> collection.
    </p>
    <p>
      <label for="confirmation-input">Type the collection name to proceed.</label>
      <input type="text" id="confirmation-input" name="confirmation-input" ng-model="vm.collectionConfirm" />
    </p>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn" id="delete" ng-click="vm.deleteCollection()">Delete</button>
    <button type="button" class="btn btn-primary" ng-click="vm.close()">Cancel</button>
  </div>
</script>

<div ng-if="vm.context.ctx.grids.length">
  <h2>GridFS Buckets</h2>
  <table class="table table-bordered table-striped table-condensed">
    <tr ng-repeat="b in vm.context.ctx.grids">
      <td class="col-md-2">
        <a ui-sref="gridfs({database: '{{ dbName }}', bucket: '{{ b }}'})" class="btn btn-success btn-block">
          <span class="glyphicon glyphicon-eye-open"></span><br>View
        </a>
      </td>
      <td>
        <h3>
          <a ui-sref="gridfs({database: '{{ dbName }}', bucket: '{{ b }}'})">{{ b }}</a>
        </h3>
      </td>
    </tr>
  </table>
</div>

<!-- COMMENTED OUT ORIGINALLY -->
<!-- {% if !settings.read_only %} -->
<!--div class="row">
  <div class="col-md-6">
    <h2>Create Collection</h2>
    <form class="well form-inline" method="POST">
        <div class="form-group">
          <span class="add-on">{{ dbName }} . </span>
          <input class="input-medium" type="text" id="collection" name="collection" placeholder="Collection Name" title="Collection Name">
        </div>
        <button type="submit" class="btn btn-primary pull-right">
          <span class="glyphicon glyphicon-plus"></span>
          Create collection
        </button>
    </form>
  </div>
</div-->
<!--
<div class="row">
  <div class="col-md-6">
    <h2>Create GridFS Bucket</h2>
    <form class="well form-inline" method="POST">
        <div class="form-group">
          <span class="add-on">{{ dbName }} . </span>
          <input class="input-medium" type="text" id="bucket" name="bucket" placeholder="Bucket Name" title="Bucket Name">
        </div>
        <button type="submit" class="btn btn-primary pull-right">
          <span class="glyphicon glyphicon-plus"></span>
          Create bucket
        </button>
    </form>
  </div>
</div>
 -->

<div class="panel panel-default stats">
  <div class="panel-heading">
    <h4 style="font-weight: bold;">Database Stats</h4>
  </div>
  <table class="table table-bordered table-striped">
    <tr>
      <td><strong>Collections (incl. system.namespaces)</strong></td>
      <td>{{ vm.context.ctx.stats.collections }}</td>
    </tr>
    <tr>
      <td><strong>Data Size</strong></td>
      <td>{{ vm.context.ctx.stats.dataSize }}</td>
    </tr>
    <tr>
      <td><strong>Storage Size</strong></td>
      <td>{{ vm.context.ctx.stats.storageSize }}</td>
    </tr>
    <tr ng-if="vm.context.ctx.stats.fileSize" >
      <td><strong>File Size (on disk)</strong></td>
      <td>{{ vm.context.ctx.stats.fileSize }}</td>
    </tr>
    <tr ng-if="vm.context.ctx.stats.avgObjSize">
      <td><strong>Avg Obj Size #</strong></td>
      <td>{{ vm.context.ctx.stats.avgObjSize }}</td>
    </tr>
    <tr ng-if="vm.context.ctx.stats.objects">
      <td><strong>Objects #</strong></td>
      <td>{{ vm.context.ctx.stats.objects }}</td>
    </tr>
    <tr ng-if="vm.context.ctx.stats.numExtents">
      <td><strong>Extents #</strong></td>
      <td>{{ vm.context.ctx.stats.numExtents }}</td>
    </tr>
    <tr ng-if="vm.context.ctx.stats.extentFreeListNum">
      <td><strong>Extents Free List</strong></td>
      <td>{{ vm.context.ctx.stats.extentFreeListNum }}</td>
    </tr>
    <tr ng-if="vm.context.ctx.stats.indexes">
      <td><strong>Indexes #</strong></td>
      <td>{{ vm.context.ctx.stats.indexes }}</td>
    </tr>
    <tr ng-if="vm.context.ctx.stats.indexSize">
      <td><strong>Index Size</strong></td>
      <td>{{ vm.context.ctx.stats.indexSize }}</td>
    </tr>
    <tr ng-if="vm.context.ctx.stats.dataFileVersion">
      <td><strong>Data File Version</strong></td>
      <td>{{ vm.context.ctx.stats.dataFileVersion }}</td>
    </tr>
  </table>
</div>