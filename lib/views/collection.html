{% block title %}{{ collectionName }}{% endblock %}

{% if collapsibleJSON %}
$(function() {
  // convert all objects to renderjson elements
  $('div.tableContent pre').each(function() {
    var text = $.trim($(this).text());

    if (text) {
      $(this).html(renderjson(JSON.parse(text)));
    }
  });
});
renderjson.set_show_to_level({{ collapsibleJSONDefaultUnfold }});
{% endif %}
</script>

  <!-- CREATES TABLE FOR ALL DOCUMENTS -->
  <div class="fadeToWhite" id="fadeToWhiteID"></div>
            {{ document[column] | stringDocIDs | to_display | safe }}
  </div>

<script type="text/javascript">

function loadDocument(id) {
  location.href = '{{ baseHref }}db/{{ dbName }}/{{ collectionName }}/' + encodeURIComponent(id);
}

$(document).ready(function() {

  if ($('.tableHeaderFooterBars').width() === $('.tableWrapper').width()) {
    // table wrapper is the same width as the table itself, so not overflowing, so remove the white gradient
    $('.fadeToWhite').remove();
  } else {
    $('.fadeToWhite').height($('.tableWrapper').height()); // limit the height only to the table div
  }

  $('.tableWrapper').scroll(function() {
    var proximityToRightOfTable = $('.tableWrapper table').width() - $('.tableWrapper').scrollLeft() - $('.tableWrapper').width();
    document.getElementById('fadeToWhiteID').style.opacity = Math.min(Math.max(proximityToRightOfTable - 50, 50) - 50, 100) / 100;
  });

  $('.tooDamnBig').bind('click', function(e) {
    e.preventDefault();
    e.stopPropagation();

    var target = $(this);
    var _id = target.attr('doc_id');
    var prop = target.attr('doc_prop');
    var spinner = '<img src="{{ baseHref }}images/gears.gif" />';
    var leftScroll = $('.tableWrapper').scrollLeft();

    // Set the element with spinner for now
    target.html(spinner);

    $.get('{{ baseHref }}db/{{ dbName }}/{{ collectionName }}/' + encodeURIComponent(_id) + '/' + prop, function(input) {

      // Images inline
      if (
        typeof input === 'string' &&
        (
          input.substr(0, 22) === 'data:image/png;base64,' ||
          input.substr(0, 22) === 'data:image/gif;base64,' ||
          input.substr(0, 22) === 'data:image/jpg;base64,' ||
          input.substr(0, 23) === 'data:image/jpeg;base64,'
        )
      )  {
        input = '<img src="' + input + '" style="max-height:100%; max-width:100%; "/>';
      }

      // Audio inline
      if (
        typeof input === 'string' &&
        (
          input.substr(0, 22) === 'data:audio/ogg;base64,' ||
          input.substr(0, 22) === 'data:audio/mp3;base64,'
        )
      )  {
        input = '<audio controls style="width:45px;" src="' + input + '">Your browser does not support the audio element.</audio>';
      }

      // Video inline
      if (
        typeof input === 'string' &&
        (
          input.substr(0, 23) === 'data:video/webm;base64,' ||
          input.substr(0, 22) === 'data:video/mp4;base64,'  ||
          input.substr(0, 22) === 'data:video/ogv;base64,'
        )
      )  {
        input = '<video controls><source type="' + input.substring(input.indexOf(':') + 1, input.indexOf(';')) + '" src="' + input + '"/>' +
          'Your browser does not support the video element.</video>';
      }

      if (typeof input === 'object' && (input.toString() === '[object Object]' || input.toString().substr(0,7) === '[object')) {
        input = renderjson(input);
      }

      // Set the element with gotten datas
      target.parent().html(input);

      // Set original scroll position
      $('.tableWrapper').scrollLeft(leftScroll);
    });
  });
});
</script>
